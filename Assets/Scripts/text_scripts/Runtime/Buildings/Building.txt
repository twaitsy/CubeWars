using UnityEngine;

/// <summary>
/// Base class for all buildings in Cube Wars.
///
/// DEPENDENCIES:
/// - ITargetable / IAttackable / IHasHealth:
///     Used by combat, AI targeting, and UI.
/// - ConstructionSite:
///     Spawns final building prefabs that inherit from Building.
/// - BuildPlacementManager:
///     Assigns teamID when placing buildings.
/// - TeamVisual:
///     Applies team colors.
/// - ResourceStorageProvider / ResourceDropoff:
///     Many buildings include these; teamID must be consistent.
///
/// RESPONSIBILITIES:
/// - Store team ownership
/// - Handle health and death
/// - Provide combat targeting info
///
/// IMPORTANT:
/// - Does NOT delete teams.
/// - Only destroys THIS building when health reaches zero.
/// </summary>
public abstract class Building : MonoBehaviour, ITargetable, IHasHealth, IAttackable
{
    [Header("Team")]
    public int teamID;

    [Header("Health")]
    public float maxHealth = 300f;
    public float currentHealth;

    // ITargetable + IAttackable
    public int TeamID => teamID;
    public bool IsAlive => currentHealth > 0;
    public Transform AimPoint => transform;

    // IHasHealth
    public float CurrentHealth => currentHealth;
    public float MaxHealth => maxHealth;

    protected virtual void Start()
    {
        currentHealth = maxHealth;
    }

    public virtual void TakeDamage(float damage)
    {
        if (!IsAlive) return;

        currentHealth -= damage;

        if (currentHealth <= 0f)
        {
            currentHealth = 0f;
            Die();
        }
    }

    protected virtual void Die()
    {
        // Only destroys THIS building, not the team.
        Destroy(gameObject);
    }
}