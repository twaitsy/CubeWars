// ============================================================================
// DiplomacyManager.cs
//
// PURPOSE:
// - Central authority for team relationships (war/peace).
// - Determines whether two teams are hostile.
// - Used by combat, AI, and future faction systems.
//
// DEPENDENCIES:
// - UnitCombatController:
//      * Calls AreAtWar(teamA, teamB) to validate targets.
// - Attackable:
//      * teamID is used to determine hostility.
// - AI Systems (AIMilitary, future strategic AI):
//      * Uses AreAtWar() to decide aggression, defense, and priorities.
// - UI Systems (future):
//      * May display diplomatic states.
// - Save/Load System (future):
//      * Must serialize warMatrix.
//
// NOTES FOR FUTURE MAINTENANCE:
// - Currently supports only symmetric war (A ? B). If you add:
//      * Alliances
//      * Neutral factions
//      * One-way hostility (A hates B but B ignores A)
//      * Diplomatic states (Ceasefire, Truce, Alliance)
//   …you will need to expand the data model.
// - warMatrix is not persisted. Add save/load integration if diplomacy
//   should persist between sessions.
// - No event system exists yet. If you add diplomacy UI or AI reactions,
//   consider adding events: OnWarDeclared, OnPeaceMade.
// - Ensure team IDs are consistent across all systems (units, buildings,
//   civilians, turrets).
// ============================================================================

using System.Collections.Generic;
using UnityEngine;

public class DiplomacyManager : MonoBehaviour
{
    public static DiplomacyManager Instance;

    // warMatrix[a] contains all teams that 'a' is at war with.
    private Dictionary<int, HashSet<int>> warMatrix =
        new Dictionary<int, HashSet<int>>();

    void Awake()
    {
        Instance = this;
    }

    /// <summary>
    /// Returns true if teams a and b are hostile.
    /// </summary>
    public bool AreAtWar(int a, int b)
    {
        if (a == b) return false;
        return warMatrix.ContainsKey(a) && warMatrix[a].Contains(b);
    }

    /// <summary>
    /// Declares symmetric war between two teams.
    /// </summary>
    public void DeclareWar(int a, int b)
    {
        Ensure(a);
        Ensure(b);
        warMatrix[a].Add(b);
        warMatrix[b].Add(a);
    }

    /// <summary>
    /// Ends war between two teams.
    /// </summary>
    public void MakePeace(int a, int b)
    {
        if (warMatrix.ContainsKey(a)) warMatrix[a].Remove(b);
        if (warMatrix.ContainsKey(b)) warMatrix[b].Remove(a);
    }

    private void Ensure(int team)
    {
        if (!warMatrix.ContainsKey(team))
            warMatrix[team] = new HashSet<int>();
    }
}