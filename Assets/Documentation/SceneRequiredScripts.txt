CubeWars - Required Scene Scripts Before Gameplay

Core bootstrap/system scripts (required)
- SceneRequiredScripts (validator component that reports missing required scripts and missing script components in the active scene)
- GameManager
- TeamStorageManager
- TeamResources
- DiplomacyManager
- BuildPlacementManager
- BuildGridManager
- ResourceRegistry
- CraftingSystem (legacy API support, optional if still crafting ToolItem assets)
- JobManager
- CraftingJobManager
- ProductionNotificationManager
- ProjectilePool

Common global managers (recommended / used by existing systems)
- SaveLoadManager
- EventManager
- AIManager
- UnitManager
- CombatManager
- TeamColorManager
- WinConditionManager

Production-chain building scripts (required if using crafting economy)
- BuildingInteractionSettings (attach to building prefabs to configure civilian stop distances)
- BuildingPrefabValidator (optional prefab self-check logger for missing required components)
- CraftingBuilding
- ProductionStatusVisualizer (optional but recommended for missing-input/full-output icons)

UI/interaction scripts
- SelectionManager
- UnitInspectorUI
- BuildMenuUI
- TaskBoardUI (if using civilian role/task management UI)
- DiagnosticUI (comprehensive runtime diagnostics overlay; toggles with D and closes other UI when opened)
- Minimap
- IMGUIInputBlocker

Scene camera/input scripts
- RTSCamera

Team setup scripts (at least one)
- TeamBootstrap OR SixTeamBootstrap OR HQSpawner

Notes
- DiplomacyManager should have "Initialize All Teams At War" enabled unless manually configured.
- BuildPlacementManager must have constructionSitePrefab assigned when useConstructionSites is true.
- Every combat unit prefab should include UnitCombatController and Attackable.
- Every civilian prefab should include Civilian + NavMeshAgent.
- ProjectilePool must exist so pooled projectiles are reused.
- Resource nodes require ResourceNode and rely on ResourceRegistry for discovery.

- Civilians assigned to crafting need matching CivilianJobType (Blacksmith, Carpenter, Farmer, Cook, Engineer) for recipe.requiredJobType.
- Crafting buildings should define inputSlot, outputSlot, workPoints[], throughput caps, and recipe batches for full logistics behavior.

RTS control/combat modernization additions
- SelectionManager (updated: drag-select, shift add/remove, contextual right-click command routing)
- UnitManager (updated: formation offset utility for group move spacing)
- UnitCombatController (updated: visionRange, behaviorState, attack-move handling, stance-aware auto-acquire)
- CombatManager (updated: default vision/combatant configuration)
- ProjectilePool + Projectile (updated: consistent pooled projectile motion/impact timing)
- Selectable (updated: selected + hover indicator support)
- UnitInspectorUI (updated: combat debug fields + robust HQ diplomacy panel lookup)
- MainMenuUI (updated: team/diplomacy match setup screen)

Prefab/component notes for updated behavior
- Combat unit prefab should include: Unit, Attackable, UnitCombatController, WeaponComponent, NavMeshAgent, Selectable.
- Civilian prefab should include: Civilian, NavMeshAgent, Selectable.
- Selectable can optionally reference:
  - selectionRing
  - hoverRing
  - attackRangeCircle
  - visionRangeCircle
- Attackable can optionally reference flashRenderer for damage flash feedback.

Needs/Housing additions
- House (required for civilian sleep recovery)
- FoodDatabase asset assigned to Civilian prefab (recommended; script path: Assets/Data/DatabaseScripts/FoodDatabase.cs)
- Civilian prefab uses hunger/tiredness fields for runtime survival

Editor productivity
- ResourceAuthoringWindow (Editor-only) for creating ResourceNode prefabs quickly

Startup placement/alignment requirements (new)
- BuildGridManager + BuildPlacementManager are required for centered multi-cell footprint placement.
- TeamBootstrap startingBuildings uses grid coordinates and footprint occupancy checks.
- Building prefabs that occupy multiple cells should include BuildingFootprint.
- See Assets/Documentation/BuildingFootprint.txt for full setup and rotation alignment guidance.

Recent behavior requirements
- CraftingBuilding.requireHaulerLogistics can enforce hauler-only transport for production input/output.
- Ensure at least one Civilian with role Hauler is available per production cluster when hauler logistics is enabled.

Storage/crafting logistics validation checklist (latest)
- ResourceStorageProvider must share a GameObject hierarchy with a ResourceStorageContainer so local capacities can be applied correctly.
- Do not rely on team-wide mirrored capacities for building-local inspector storage views.
- Ensure CraftingBuilding recipes only request resources that have actual storage capacity configured in scene setup.
- Keep at least one reachable storage with free capacity for each gathered/crafted resource type to avoid logistics stalls.


- BuildingPrefabValidator now warns about conflicting/not-required script combinations (for example: multiple production scripts on one prefab, ProductionStatusVisualizer without CraftingBuilding, ResourceStorageProvider without ResourceStorageContainer).
- Crafting logistics expectation: haulers should always stock crafting input buffers first, then move crafted outputs to external storage providers second.


- Crafting hauler assignment should not force Hauler -> Crafter role conversion; otherwise requireHaulerLogistics stalls.
- CraftingBuilding prefab hierarchies should contain exactly one ResourceStorageContainer to prevent local storage split/conflicts.
- BuildingPrefabValidator now warns when CraftingBuilding has multiple ResourceStorageContainer components in hierarchy.
Related documentation
- Crafting building prefab setup: Assets/Documentation/CraftingBuildingPrefabSetup.txt


Storage flow configuration requirements (new)
- ResourceStorageContainer now includes per-resource hauling flow controls in Inspector:
  - Disabled
  - ReceiveOnly
  - SupplyOnly
  - ReceiveAndSupply
- Configure these for every crafting/storage building so haulers know valid pickup/drop-off targets.
- UnitInspectorUI shows per-resource flow at runtime under the Storage tab.


- Simplified crafting role split:
  - Haulers perform crafting transport (input-in first, output-out second).
  - Other selected civilians (matching required job type) are expected to stay near crafting work points to keep production active.


Latest script requirements/additions
- WorldProgressBar (optional): attach to buildings/objects that need future world-space progress visualization (construction, upgrades, etc.).

Behavioral expectations to verify in scenes
- Crafting haulers should deliver up to their civilian carry capacity per trip when input buffers are missing resources.
- Idle civilians should show an assigned house in inspector when capacity exists; otherwise inspector should display "Homeless".
- Barracks and Turret should expose a demolish action from UnitInspectorUI Overview.
- TeamBootstrap-spawned HQ positions should align to BuildGridManager cell coordinates.

Latest required script links (Unified civilian jobs/tools update)
- CivilianJobRegistry (maps unified CivilianJobType into runtime work domains + legacy role compatibility)
- CivilianToolRegistry (defines job-specific and universal tools/bonuses)

Scene setup checks
- Ensure a TeamInventory exists in-scene for civilians to claim crafted tools.
- Ensure house prefabs that should store food include one ResourceStorageContainer (it will run as ReceiveOnly for hauler flow).
- Keep at least one non-house storage with Supply enabled for food so civilians can still retrieve food logistics when house stock is empty.


Latest crafting/needs runtime checks
- Civilian + CraftingBuilding pairing now expects valid NavMesh paths from civilian spawn areas to crafting work points; unreachable work points trigger stall recovery and assignment clear after ~10s.
- House prefabs that should serve nearby resident meals must include a ResourceStorageContainer with edible resources (ReceiveOnly flow is acceptable; residents bypass hauling flow checks when eating at home).
- Crafting production throughput depends on active workers physically present at site/workpoint, not just assigned worker count.

Database migration note
- TeamAIBuild now references BuildingsDatabase (Assets/Data/Databases/BuildingsDatabase.asset) for buildable item catalog data.
- BuildMenuUI now resolves build catalog data from BuildingsDatabase first (inspector ref -> GameDatabase.buildings -> editor fallback path Assets/Data/Databases/BuildingsDatabase.asset), then falls back to Resources path only if no database is available.

Detailed build-menu database format support (new)
- No new scene-level manager is required.
- BuildMenuUI + BuildPlacementManager remain required for player build flow.
- Ensure `BuildingsDatabase` is assigned (directly on BuildMenuUI, via GameDatabase.buildings, or at `Assets/Data/Databases/BuildingsDatabase.asset`).
- For detailed catalog usage, populate `BuildingsDatabase.buildings` entries with at minimum: `displayName`/`id`, `prefab`, `category` or `subCategory`, and optional `constructionCost`.
- `ResourceDefinition.id`/`displayName` values in `constructionCost` should map to existing `ResourceType` names (e.g., Wood, Gold, IronOre, Silicon, Lithium) for affordability checks.


Resource database wiring requirements (latest)
- Assign `ResourcesDatabase` on ResourceSpawner to enforce Raw-only node spawn configs.
- Assign `ResourcesDatabase` on CraftingBuilding to enforce Refined-only recipe outputs.
- Assign `ResourcesDatabase` on Civilian prefab(s) so edible resources are detected by Food category.
- FoodDatabase should be assigned for data-driven civilian hunger behavior.


[2026 Data-driven resources migration]
- ResourceType enum has been removed from runtime data flow.
- All resource references should use ResourceDefinition assets (or resource IDs resolved via ResourcesDatabase).
- Food behavior is now resolved through FoodDatabase + FoodDefinition (hungerRestore, eatTime, requiresCooking, perishable, spoilTime).
- Civilians, storage, crafting/recipes, and UI should query FoodDatabase for edible checks and hunger restore values.

[2026 Editor and database updates]
Editor menu/tooling categories
- Tools/CubeWars/Documentation (index + docs exporters)
- Tools/CubeWars/Analysis (dependency/script scans)
- Tools/CubeWars/Validation (stats coverage checks)
- Tools/CubeWars/Database (Game Database editor)

Database linkage requirements (scene + prefabs)
- Scene must include `GameDatabaseLoader` with a valid `GameDatabase` asset.
- Unit prefabs should set `Unit.unitDefinitionId` to match a `UnitsDatabase` entry.
- Civilian prefabs should set `Civilian.unitDefinitionId` (recommended: `civilian`).
- Building prefabs should set `Building.buildingDefinitionId` to match `BuildingsDatabase` entries.
- DefenseTurret prefabs should rely on `Building.buildingDefinitionId` to receive attack range/damage from the database when available.

Editor output path standard
- Generated editor outputs should be stored under: `Assets/Documentation/EditorToolsOutput`.

Maintenance note (2026-02)
- No new required scene scripts were introduced.
- Runtime efficiency updates were applied to existing scripts:
  - WinConditionManager (interval-based victory checks + single winner declaration)
  - AIResourceManager (cached subsystem references + squared-distance node claim checks)
  - AIThreatDetector (squared-distance threat checks + cached diplomacy lookup per scan)

- No new required runtime scene scripts. Editor-only update: database editing is now split into separate per-database windows under Tools/CubeWars/Database.

- Editor script layout: each database window now lives in its own script file under `Assets/Data/DatabaseEditors` (`BuildingsDatabaseEditorWindow.cs`, `FoodsDatabaseEditorWindow.cs`, `JobsDatabaseEditorWindow.cs`, `RecipesDatabaseEditorWindow.cs`, `ResourcesDatabaseEditorWindow.cs`, `ToolsDatabaseEditorWindow.cs`, `UnitsDatabaseEditorWindow.cs`), with shared logic kept in `GameDatabaseEditorWindow.cs`.

Tool bonus runtime wiring checks (2026-02)
- No new required scene script components were added.
- Existing job/task systems that compute work speed should call `BonusCalculator.GetFinalMultiplier(job, tool, resource)` with the active job resource to apply `ToolDefinition.baseEfficiency` and matching `BonusDefinition` entries.
- `ToolsDatabase` and `ResourcesDatabase` IDs should remain authoritative; Resource-targeted bonuses rely on matching resource IDs from shallow-copied `BonusDefinition.resource` data.

Maintenance note (2026-02 civilian logistics)
- No new required scene scripts were added.
- Verify Civilian job loops can return to the proper state after deposit:
  - Gatherer -> SearchingNode
  - Builder -> SearchingBuildSite
  - Hauler -> SearchingSupplySite
- Verify gatherable nodes are GameObjects with ResourceNode + valid ResourceDefinition assigned.
- Keep HQ storage wiring intact (ResourceStorageContainer + ResourceStorageProvider) so TeamStorageManager queries still support gatherer, hauler, and builder pickup/delivery flows.

[2026 Capability-profile jobs + unified task dispatcher]
Required in gameplay scenes:
- WorkerTaskDispatcher
- WorkerTaskGenerationSystem

Updated expectations:
- Civilian prefabs should assign `jobDefinition` capability profile assets from `Assets/Data/Definitions/Jobs`.
- Dispatcher assigns only workers whose job profile exposes matching capabilities (Gather/Haul/Build/Craft).
- Crafting manual assignment now routes through WorkerTaskDispatcher task assignment instead of direct per-system hardcoding.
- Job/task-related enums are now stored in `Assets/Data/Enums`.

[2026-02 civilian gathering + building database sync]
- No new scene-wide manager requirement was added.
- Existing requirement remains: scene must include GameDatabaseLoader with a valid GameDatabase asset.
- Ensure storage buildings (especially HQ) are represented in BuildingsDatabase with storage enabled so ResourceStorageProvider can register at least 1000 capacity for all resources.
- Ensure build/starting building prefabs used in scene setup exist in BuildingsDatabase entries (HQ, Barracks, Defense Turret, House, CraftingStation).

- Headquarters starting resources are now applied when storage capacity becomes available; ensure HQ prefabs include both ResourceStorageContainer and ResourceStorageProvider.
- TaskBoardUI now surfaces workforce state buckets (waiting/moving/collecting/producing) plus node, construction, crafting, and dispatcher queue fulfillment metrics.

[2026-02 gather slot dispatch validation update]
Required in gameplay scenes:
- WorkerTaskDispatcher
- WorkerTaskGenerationSystem

Behavior expectations:
- Gather task generation now mirrors open gather slots on each node (`maxGatherers - ActiveGatherers`) and accounts for already queued gather tasks per node.
- Dispatcher should only assign newly queued tasks to available civilians (Idle or Searching states) to avoid reassigning workers already traveling/working.


Workforce/resource diagnostics (latest)
- SceneRequiredScripts now performs extra validation for workforce setup:
  - Warns when Civilian.unitDefinitionId is missing or not found in loaded UnitsDatabase.
  - Warns when ResourceNode has no resource assigned.
  - Warns when ResourceNode.resource is not present in loaded ResourcesDatabase.
- BuildingPrefabValidator can now validate Building, Civilian, and ResourceNode prefabs from one component and reports database/configuration issues.
- Civilian prefabs do NOT require ResourceStorageContainer/ResourceStorageProvider for normal gathering/hauling.

Storage specialization additions (latest)
- StorageFacility script (attach to StorageFacility / FoodStorageFacility / RawMaterialStorageFacility / ToolStorageFacility prefabs).
- StorageFacility auto-populates ResourceStorageProvider capacities from ResourcesDatabase and keeps ResourceStorageContainer flow map in sync.
- If a StorageFacility category filter is used, verify allowedCategories matches the intended ResourceCategory (Food, Raw, Tool, etc.).

Crafting inspector additions (latest)
- UnitInspectorUI production tab now reads from RecipesDatabase and allows selecting active recipe at runtime.
- RecipesDatabase should contain at least one recipe so inspector selection buttons are populated.

Update notes (database/runtime UI pass)
- SceneRequiredScripts now resolves GameDatabase through GameDatabaseLoader.ResolveLoaded() so validation can still find databases even if loader execution timing differs.
- Recipes diagnostics now differentiates between "database not loaded" and "recipes list empty" to make setup issues easier to diagnose.
- Team scenes should keep one active GameDatabaseLoader with a valid GameDatabase assigned so civilians, crafting stations, and resource validation all share the same source of truth.

Database/content minimums used by current setup
- ResourcesDatabase should contain at least 50 resource entries for common RTS gathering/crafting chains.
- JobsDatabase should contain at least 10 civilian job definitions.
- FoodDatabase should contain at least 20 food entries.
- RecipesDatabase should contain at least 40 recipe entries.
- ToolsDatabase should contain at least 20 tool entries.

Team bootstrap + civilian equipment requirements
- TeamBootstrap now supports one-civilian-per-job startup via `spawnOneCivilianPerJob` + `startingJobTypes`.
- Default startup configuration should include Gatherer, Builder, Hauler, Crafter, Farmer, Technician, Scientist, Engineer, Blacksmith, Carpenter, Cook.
- Spawned civilians should be initialized with a starting tool appropriate to their configured job.

Resource node assignment behavior
- ResourceNode keeps manual resource assignment in inspector.
- If no manual resource is assigned, ResourceNode attempts auto-assignment using the node GameObject name matching a resource id/display name key.

Crafting stability requirement
- CraftingBuilding and related recipe-selection flows must tolerate incomplete/invalid recipe entries without crashing (null-safe recipe entry handling).

[2026-02 resource node auto-assignment compile fix]
- ResourceNode now uses the node GameObject name token directly when attempting auto-assignment from ResourcesDatabase IDs/display names.
- Keep node names aligned with resource IDs/display names if relying on auto-assignment fallback.

Worker task priority + crafting role coverage (latest)
- WorkerTaskGenerationSystem should scan Build/Haul/Craft tasks before Gather tasks.
- Gather tasks are intentionally lowest priority and should only queue when no other worker tasks are waiting.
- Craft task assignment should respect ProductionRecipe.requiredJobType and auto-switch assigned workers into the required job type when a valid craft task is accepted.
- Team bootstrap should provide at least ~6 crafting-capable specialists at match start to prevent early production deadlocks.
- UnitInspectorUI Production tab should show why crafting has not started and expose recipe lists inside scroll views.

Crafting assignment registration diagnostics (latest)
- SceneRequiredScripts now checks for crafting assignment desync where civilians are linked to a CraftingBuilding but the building has fewer registered assigned workers.
- If warning appears, reassigning those civilians refreshes registration; runtime assignment code should call CraftingBuilding.TryAssignWorker when assigning craft tasks.
